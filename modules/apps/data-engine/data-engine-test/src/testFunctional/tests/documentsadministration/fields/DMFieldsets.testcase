@component-name = "portal-document-management"
definition {

	property portal.release = "true";
	property portal.upstream = "true";
	property testray.main.component.name = "Documents Management";

	setUp {
		TestCase.setUpPortalInstance();

		User.firstLoginPG();
	}

	tearDown {
		var testPortalInstance = PropsUtil.get("test.portal.instance");

		if ("${testPortalInstance}" == "true") {
			PortalInstances.tearDownCP();
		}
		else {
			DMDocument.tearDownCP();

			User.logoutPG();
		}
	}

	@description = "This is a test for LPS-107630. As an App Adm, I want to use an existing fieldset"
	@ignore = "true"
	@priority = "4"
	test AddFieldsetOnOtherFieldsetAlreadyOnBuilder {
		property portal.acceptance = "false";

		// TODO LPS-107630 AddFieldsetOnOtherFieldsetAlreadyOnBuilder pending implementation

	}

	@description = "This is a test for LPS-107630. As an App Adm, I want to use an existing fieldset"
	@ignore = "true"
	@priority = "4"
	test EditFieldsetPropertiesFromSideBar {
		property portal.acceptance = "false";

		// TODO LPS-107630 EditFieldsetPropertiesFromSideBar pending implementation
	}

	@description = "This is a test for LPS-107630. As an App Adm, I want to use an existing fieldset"
	@priority = "4"
	test FieldsetSetAsCollapsible {
		property portal.acceptance = "false";

		DMNavigator.openDocumentsAndMediaAdmin(siteURLKey = "guest");

		DMNavigator.gotoDocumentType();

		LexiconEntry.gotoAdd();

		PortletEntry.inputName(name = "CollapsibleTest");

		DataEngine.addFields(fieldNameList = "Text,Image");

		DDLDataDefinition.save();

		DMNavigator.openDocumentsAndMediaAdmin(siteURLKey = "guest");

		DMNavigator.gotoDocumentType();

		LexiconEntry.gotoAdd();

		PortletEntry.inputName(name = "CollapsibleTest1");

		DataEngine.addFieldsets(
			fieldsetsLabel = "CollapsibleTest",
			fieldsetsName = "CollapsibleTest");

		DataEngine.editFieldsetsCollapsible(fieldsetLabel = "CollapsibleTest");

		Click(locator1 = "DDMEditStructure#FORM_FIELD_SETS_CONTAINER_COLLAPSIBLE_UP");

		Pause(locator1 = "3000");

		Click(locator1 = "DDMEditStructure#FORM_FIELD_SETS_CONTAINER_COLLAPSIBLE_DOWN");

		DDLDataDefinition.save();

		DMDocumentType.viewCP(dmDocumentTypeName = "CollapsibleTest1");
	}

	@description = "This is a test for LPS-107630. As an App Adm, I want to use an existing fieldset"
	@priority = "4"
	test FieldsetSetAsRepeatable {
		property portal.acceptance = "false";

		DMNavigator.openDocumentsAndMediaAdmin(siteURLKey = "guest");

		DMNavigator.gotoDocumentType();

		LexiconEntry.gotoAdd();

		PortletEntry.inputName(name = "RepeatableTest");

		DataEngine.addFields(fieldNameList = "Text,Image");

		DDLDataDefinition.save();

		DMNavigator.openDocumentsAndMediaAdmin(siteURLKey = "guest");

		DMNavigator.gotoDocumentType();

		LexiconEntry.gotoAdd();

		PortletEntry.inputName(name = "RepeatableTest1");

		DataEngine.addFieldsets(
			fieldsetsLabel = "RepeatableTest",
			fieldsetsName = "RepeatableTest");

		DataEngine.editFieldsetsRepeatable(fieldsetLabel = "RepeatableTest");

		DDLDataDefinition.save();

		DMDocumentType.viewCP(dmDocumentTypeName = "RepeatableTest1");

		DMNavigator.openDocumentsAndMediaAdmin(siteURLKey = "guest");

		DMNavigator.gotoAddDocumentTypeCP(dmDocumentTypeName = "RepeatableTest1");

		AssertElementPresent(locator1 = "FormFields#FIELD_ADD_DUPLICATE");
	}

	@description = "This is a test for LPS-107630. As an App Adm, I want to use an existing fieldset"
	@priority = "4"
	test RepeatFieldsetWithoutDuplicatingContent {
		property portal.acceptance = "false";

		var documentDescription = "Description";
		var documentType = "DM Document Type Name";
		var fieldName = "Upload";
		var documentName = "Document_1.jpg";

		JSONDocument.addFileWithUploadedFile(
			dmDocumentDescription = "DM Document Description",
			dmDocumentTitle = "${documentName}",
			groupName = "Guest",
			mimeType = "image/jpeg",
			sourceFileName = "${documentName}");	

		ProductMenu.gotoPortlet(
       		category = "Content & Data",
       		portlet = "Documents and Media"
		);

		DMNavigator.gotoDocumentType();

		DMDocumentType.addWithoutSave(
			dmDocumentTypeDescription = "${documentDescription}",
			dmDocumentTypeName = "${documentType}",
			dmDocumentTypeFieldNames = "${fieldName}"
		);

		DataEngine.editFieldRepeatable(fieldFieldLabel = "${fieldName}");

		Button.clickSave();
			
		Navigator.gotoNavItem(navItem = "Documents and Media");

		DMNavigator.gotoAddDocumentTypeCP(dmDocumentTypeName = "${documentType}");

		PortletEntry.inputTitle(title = "Title");

		ItemSelector.gotoItemSelectorViaSelectButton();

		ItemSelector.selectDMImage(
			navTab = "Documents and Media",
			imageFileName = "${documentName}"
		);

		DataEngine.addRepeatableField(
			fieldName = "${fieldName}"
		);

		AssertTextNotPresent(
			locator1 = "FormFields#TEXT_FIELD_NULL",
			value1 = "Document_1.jpg");

		PortletEntry.publish();
	}	

	@description = "This is a test for LPS-107630. As an App Adm, I want to use an existing fieldset"
	@priority = "4"
	test ShowAndHideFieldsetLabel {
		property portal.acceptance = "false";

		DMNavigator.openDocumentsAndMediaAdmin(siteURLKey = "guest");

		DMNavigator.gotoDocumentType();

		LexiconEntry.gotoAdd();

		PortletEntry.inputName(name = "ShowAndHideTest");

		DataEngine.addFields(fieldNameList = "Text,Image");

		DDLDataDefinition.save();

		DMNavigator.openDocumentsAndMediaAdmin(siteURLKey = "guest");

		DMNavigator.gotoDocumentType();

		LexiconEntry.gotoAdd();

		PortletEntry.inputName(name = "ShowAndHideTest1");

		DataEngine.addFieldsets(
			fieldsetsLabel = "ShowAndHideTest",
			fieldsetsName = "ShowAndHideTest");

		DataEngine.configureFieldsetsShowOrHideLabel(
			fieldFieldLabel = "Text",
			status = "Hide");

		DDLDataDefinition.save();

		LexiconEntry.openEntryMenu(rowEntry = "ShowAndHideTest1");

		MenuItem.click(menuItem = "Edit");

		AssertElementNotPresent(
			key_fieldsetLabel = "ShowAndHideTest",
			locator1 = "DDMEditStructure#FORM_FIELD_SETS_CONTAINER_LABEL");

		DataEngine.configureFieldsetsShowOrHideLabel(
			fieldFieldLabel = "Text",
			status = "Show");

		AssertElementPresent(
			key_fieldsetLabel = "ShowAndHideTest",
			locator1 = "DDMEditStructure#FORM_FIELD_SETS_CONTAINER_LABEL");

		DDLDataDefinition.save();

		DMDocumentType.viewCP(dmDocumentTypeName = "ShowAndHideTest1");
	}

}