@component-name = "portal-commerce"
definition {

	property portal.release = "true";
	property portal.upstream = "true";
	property testray.main.component.name = "Commerce";

	setUp {
		TestCase.setUpPortalInstance();

		User.firstLoginPG();
	}

	tearDown {
		var testPortalInstance = PropsUtil.get("test.portal.instance");

		if ("${testPortalInstance}" == "true") {
			PortalInstances.tearDownCP();
		}
		else {
			Navigator.openURL();

			CommerceConfiguration.commerceAdminTearDown();

			CommerceConfiguration.commerceInitializersTearDown();
		}
	}

	@description = "COMMERCE-6343. As a buyer, I want to be able to select only the allowed quantities of a cart item, if set"
	@ignore = "true"
	@priority = "3"
	test AssertOnlyAllowedQuantitiesAreSelectableInMiniCartItem {
		property portal.acceptance = "false";

		// TODO COMMERCE-6343 AssertOnlyAllowedQuantitiesAreSelectableInMiniCartItem pending implementation

	}

	@description = "COMMERCE-6346. As a buyer, I want to be able to select the quantity of a cart item by multiple value, if set"
	@ignore = "true"
	@priority = "3"
	test AssertOnlyMultipleValuesAreSelectableQuantitiesInMiniCartItem {
		property portal.acceptance = "false";

		// TODO COMMERCE-6346 AssertOnlyMultipleValuesAreSelectableQuantitiesInMiniCartItem pending implementation
	}

	@description = "COMMERCE-6345. As a buyer, I want to be able to select the quantity of a cart item up to a maximum quantity, if set"
	@ignore = "true"
	@priority = "3"
	test AssertQuantityInMiniCartItemCanBeSelectedUpToAMaximumQuantitySet {
		property portal.acceptance = "false";

		// TODO COMMERCE-6345 AssertQuantityInMiniCartItemCanBeSelectedUpToAMaximumQuantitySet pending implementation
	}

	@description = "COMMERCE-6344. As a buyer, I want to be able to select the quantity of a cart item starting from a minimum quantity, if set"
	@ignore = "true"
	@priority = "3"
	test AssertSelectableQuantitiesInMiniCartItemStartFromMinimumQuantitySet {
		property portal.acceptance = "false";

		// TODO COMMERCE-6344 AssertSelectableQuantitiesInMiniCartItemStartFromMinimumQuantitySet pending implementation
	}

	@description = "COMMERCE-6335. As a buyer, I want to edit the quantity of an bundled product in the mini-cart using it's quantity selector and I want to view the changes applied to the mini-cart summary and the bundled items to change their quantity"
	@priority = "3"
	test EditBundledProductQuantityFromMiniCart {
		property portal.acceptance = "false";

		CommerceAccelerators.initializeNewSiteViaAccelerator(siteName = "Minium");

		CommerceNavigator.gotoPortlet(
			category = "Product Management",
			portlet = "Options");

		CPCommerceCatalog.newOptionsEntry(
			optionDescription = "Option Description",
			optionFieldType = "Select from List",
			optionName = "Color");

		Button.clickSave();

		Check.checkToggleSwitch(
			key_toggleSwitchLabel = "Use in Faceted Navigation",
			locator1 = "ToggleSwitch#ANY_TOGGLE_SWITCH");

		Check.checkToggleSwitch(
			key_toggleSwitchLabel = "Required",
			locator1 = "ToggleSwitch#ANY_TOGGLE_SWITCH");

		Check.checkToggleSwitch(
			key_toggleSwitchLabel = "SKU Contributor",
			locator1 = "ToggleSwitch#ANY_TOGGLE_SWITCH");

		Button.clickSave();

		Click(locator1 = "Button#PLUS");

		SelectFrame(locator1 = "IFrame#MODAL_BODY");

		CommerceEntry.addOptionValue(
			valueName = "Black",
			valuePosition = "");

		Button.click(button = "Submit");

		SelectFrameTop();

		Button.clickSave();

		CommerceNavigator.gotoPortlet(
			category = "Product Management",
			portlet = "Products");

		CPCommerceCatalog.newProductsEntry(
			productCatalog = "Minium",
			productName = "Bundled Product",
			productType = "Simple");

		CommerceEntry.gotoMenuTab(menuTab = "Options");

		Type(
			key_title = "Add Options",
			locator1 = "CommerceEntry#ADD_RELATION_FIELD",
			value1 = "Color");

		Button.click(button = "Select");

		Refresh();

		CommerceNavigator.gotoEntry(entryName = "Color");

		SelectFrame.selectFrameNoLoading(locator1 = "CommerceEntry#IFRAME_SIDE_PANEL");

		Select(
			key_fieldLabel = "Price Type",
			locator1 = "Select#GENERIC_SELECT_FIELD",
			value1 = "Static");

		Button.clickSave();

		Alert.viewSuccessMessage();

		Click(
			key_index = "Black",
			locator1 = "WorkflowMetrics#SEARCH_FIELD_MAPPINGS_METRICS_INDEXES");

		Type(
			key_fieldLabel = "Delta Price",
			locator1 = "TextInput#GENERIC_TEXT_INPUT",
			value1 = "60.00");

		Type(
			key_fieldLabel = "SKU",
			locator1 = "TextInput#GENERIC_TEXT_INPUT",
			value1 = "MIN55861");

		Button.clickSave();

		Alert.viewSuccessMessage();

		Refresh();

		CommerceEntry.gotoMenuTab(menuTab = "SKUs");

		Click(locator1 = "Button#PLUS");

		Click(
			key_fieldName = "Add SKU",
			locator1 = "FormViewBuilder#OBJECT_FIELD_BUTTON_DROPDOWN");

		SelectFrame.selectFrameNoLoading(locator1 = "CommerceEntry#IFRAME_SIDE_PANEL");

		Type(
			key_fieldLabel = "SKU",
			locator1 = "TextInput#GENERIC_TEXT_INPUT",
			value1 = "BLACKSKU");

		Click(locator1 = "Dropdown#TRIGGER");

		Click(
			key_fieldName = "Black",
			locator1 = "FormViewBuilder#OBJECT_FIELD_BUTTON_DROPDOWN");

		Check.checkToggleSwitch(
			key_toggleSwitchLabel = "Purchasable",
			locator1 = "ToggleSwitch#ANY_TOGGLE_SWITCH");

		Type(
			key_fieldLabel = "Base Price",
			locator1 = "TextInput#GENERIC_TEXT_INPUT",
			value1 = "10.0");

		Button.click(button = "Publish");

		Pause(locator1 = "1000");

		Refresh();

		ApplicationsMenu.gotoSite(site = "Minium");

		CommerceNavigator.gotoMiniumSidebarItem(menuItem = "Account Management");

		CommerceAcceleratorsInitializer.createNewAccountViaFront(
			accountName = "First Account",
			adminEmailAddress = "test@liferay.com");

		CommerceNavigator.gotoMiniumSidebarItem(menuItem = "Catalog");

		Click(
			key_productName = "bundled-product",
			locator1 = "CommerceAccelerators#PRODUCT_CARD_VIEW_ALL_VARIANTS");

		Click(
			key_productName = "Bundled Product",
			locator1 = "CommerceAccelerators#ADD_TO_CART_BUTTON_BY_PRODUCT");

		CommerceNavigator.gotoMiniCart();

		Type(
			key_cartItemSKU = "BLACKSKU",
			locator1 = "CommerceAccelerators#MINI_CART_ITEM_QUANTITY",
			value1 = "3");

		AssertElementPresent(
			key_cartItemSKU = "BLACKSKU",
			locator1 = "CommerceAccelerators#MINI_CART_ITEM_QUANTITY",
			value1 = "3");
	}

	@description = "COMMERCE-6333. As a buyer, I want to edit the quantity of an item in the mini-cart using it's quantity selector and I want to view the changes applied to the mini-cart summary"
	@priority = "3"
	test EditCartItemQuantityFromMiniCart {
		property portal.acceptance = "false";

		CommerceAccelerators.initializeNewSiteViaAccelerator(siteName = "Minium");

		ApplicationsMenu.gotoSite(site = "Minium");

		CommerceNavigator.gotoMiniumSidebarItem(menuItem = "Account Management");

		CommerceAcceleratorsInitializer.createNewAccountViaFront(
			accountName = "Commerce Account",
			adminEmailAddress = "test@liferay.com");

		CommerceNavigator.gotoMiniumSidebarItem(menuItem = "Catalog");

		FrontStore.addInitializerProductToCart(
			productName = "U-Joint",
			productQuantity = "1");

		CommerceNavigator.gotoMiniCart();

		Type(
			key_cartItemSKU = "MIN55861",
			locator1 = "CommerceAccelerators#MINI_CART_ITEM_QUANTITY",
			value1 = "3");

		AssertTextEquals(
			key_summaryTableItem = "Quantity",
			locator1 = "CommerceAccelerators#MINI_CART_SUMMARY_TABLE_ITEM",
			value1 = "3");

		AssertTextEquals(
			key_summaryTableItem = "Subtotal",
			locator1 = "CommerceAccelerators#MINI_CART_SUMMARY_TABLE_ITEM",
			value1 = "$ 72.00");

		AssertTextEquals(
			key_summaryTableItem = "Order Discount",
			locator1 = "CommerceAccelerators#MINI_CART_SUMMARY_TABLE_ITEM",
			value1 = "$ 0.00");

		AssertTextEquals(
			locator1 = "CommerceAccelerators#MINI_CART_SUMMARY_TABLE_TOTAL",
			value1 = "$ 72.00");
	}

	@description = "COMMERCE-6330. As a buyer, I want to be able to empty my open cart after clicking on 'Remove All Items'(Yes/No)"
	@ignore = "true"
	@priority = "3"
	test RemoveAllItemsFromMiniCart {
		property portal.acceptance = "false";

		// TODO COMMERCE-6330 RemoveAllItemsFromMiniCart pending implementation
	}

	@description = "COMMERCE-6331. As a buyer, I want to be able to remove an item from cart by clicking on the delete button('x')"
	@ignore = "true"
	@priority = "3"
	test RemoveSingleCartItemFromMiniCart {
		property portal.acceptance = "false";

		// TODO COMMERCE-6331 RemoveSingleCartItemFromMiniCart pending implementation
	}

	@description = "COMMERCE-6348. As a buyer, I want the first selectable quantity of a cart item to be the minimum multiple quantity if Minimum Order Quantity is higher than Multiple Order Quantity"
	@ignore = "true"
	@priority = "3"
	test ViewFirstSelectableQuantityInMiniCartItemWhenMinimumOrderQuantityIsHigherThanMultipleOrderQuantity {
		property portal.acceptance = "false";

		// TODO COMMERCE-6348 ViewFirstSelectableQuantityInMiniCartItemWhenMinimumOrderQuantityIsHigherThanMultipleOrderQuantity pending implementation
	}

	@description = "COMMERCE-6349. As a buyer, I want the first selectable quantity of a cart item to be the minimum multiple quantity if Minimum Order Quantity is lower than Multiple Order Quantity"
	@ignore = "true"
	@priority = "3"
	test ViewFirstSelectableQuantityInMiniCartItemWhenMinimumOrderQuantityIsLowerThanMultipleOrderQuantity {
		property portal.acceptance = "false";

		// TODO COMMERCE-6349 ViewFirstSelectableQuantityInMiniCartItemWhenMinimumOrderQuantityIsLowerThanMultipleOrderQuantity pending implementation
	}

	@description = "COMMERCE-6334. As a buyer, I want to be able to view bundled product details in the mini-cart(Name, SKU, Bundled Items, Quantity, List Price, Image)"
	@ignore = "true"
	@priority = "3"
	test ViewMiniCartBundledProductDetails {
		property portal.acceptance = "false";

		// TODO COMMERCE-6334 ViewMiniCartBundledProductDetails pending implementation
	}

	@description = "COMMERCE-6332. As a buyer, I want to view cart item details in the mini-cart(Name, SKU, Quantity, Options(if present), List Price, Image) and I want to be able to view the number of different products I have in my cart"
	@priority = "3"
	test ViewMiniCartItemDetails {
		property portal.acceptance = "false";

		CommerceAccelerators.initializeNewSiteViaAccelerator(siteName = "Minium");

		ApplicationsMenu.gotoSite(site = "Minium");

		CommerceNavigator.gotoMiniumSidebarItem(menuItem = "Account Management");

		CommerceAcceleratorsInitializer.createNewAccountViaFront(
			accountName = "Commerce Account",
			adminEmailAddress = "test@liferay.com");

		CommerceNavigator.gotoMiniumSidebarItem(menuItem = "Catalog");

		Type(
			locator1 = "AppBuilder#SEARCH_BAR_INPUT",
			value1 = "U-Joint");

		Click(locator1 = "Button#SUBMIT");

		FrontStore.addInitializerProductToCart(
			productName = "U-Joint",
			productQuantity = "3");

		Type(
			locator1 = "AppBuilder#SEARCH_BAR_INPUT",
			value1 = "Hoses");

		Click(locator1 = "Button#SUBMIT");

		CommerceAcceleratorsInitializer.gotoMiniumProductDetailsPage(productName = "Hoses");

		Click(locator1 = "CommerceFrontStore#PRODUCT_DETAILS_PACKAGE_QUANTITY");

		Click(
			key_selectValue = "24",
			locator1 = "CommerceEntry#OPTIONS_SELECT_LIST");

		Click(locator1 = "CommerceAccelerators#ADD_TO_CART_BUTTON_PRODUCT_DETAILS_PAGE");

		Notifications.viewBadgeCount(notificationCount = "2");

		Click(locator1 = "CommerceAccelerators#MINI_CART_BUTTON");

		AssertTextEquals(
			locator1 = "CommerceAccelerators#MINI_CART_RESUME",
			value1 = "2 Products");

		FrontStore.viewMiniCart(
			cartItemNames = "Hoses",
			cartItemOption = "24",
			cartItemPriceValues = "120",
			cartItemQuantities = "1",
			cartItemSKUs = "MIN93022B");

		FrontStore.viewMiniCart(
			cartItemNames = "U-Joint",
			cartItemPriceValues = "24",
			cartItemQuantities = "3",
			cartItemSKUs = "MIN55861");
	}

	@description = "COMMERCE-6338. As a buyer, I want to see the barred list price, the discount percentage and the discounted price of an item in the mini-cart, if a discount is set"
	@priority = "3"
	test ViewMiniCartItemWithDiscount {
		property portal.acceptance = "false";
		property test.name.skip.portal.instance = "CommerceMiniCart#ViewMiniCartItemWithDiscount";

		CommerceAccelerators.initializeNewSiteViaAccelerator(siteName = "Minium");

		CommerceNavigator.gotoPortlet(
			category = "Pricing",
			portlet = "Discounts");

		Click(locator1 = "Button#PLUS");

		CommerceEntry.addNewDiscountsEntry(
			channelsEligibility = "Minium Portal",
			discountAmount = "20",
			discountName = "Test Discount",
			discountTarget = "Products",
			discountType = "Percentage");

		CommerceRelations.assignSingleRelationToProductsEntry(
			entryName = "ABS Sensor",
			title = "Add Products");

		Button.clickPublish();

		ApplicationsMenu.gotoSite(site = "Minium");

		CommerceNavigator.gotoMiniumSidebarItem(menuItem = "Account Management");

		CommerceAcceleratorsInitializer.createNewAccountViaFront(
			accountName = "Commerce Account",
			adminEmailAddress = "test@liferay.com");

		ApplicationsMenu.gotoSite(site = "Minium");

		CommerceAcceleratorsInitializer.changeProductsSorting(sortingType = "Name Ascending");

		FrontStore.addInitializerProductToCart(
			productName = "ABS Sensor",
			productQuantity = "1");

		CommerceNavigator.gotoMiniCart();

		AssertElementPresent(locator1 = "CommerceAccelerators#PRODUCT_DETAILS_LIST_PRICE_INACTIVE");

		AssertElementPresent(locator1 = "CommerceAccelerators#PRODUCT_DETAILS_DISCOUNT");

		AssertElementPresent(locator1 = "CommerceAccelerators#PRODUCT_DETAILS_NET_PRICE");
	}

	@description = "COMMERCE-6339. As a buyer, I want to see the barred list price, the discount levels and the discounted price of an item in the mini-cart, if discount levels are set and visible"
	@ignore = "true"
	@priority = "3"
	test ViewMiniCartItemWithDiscountLevels {
		property portal.acceptance = "false";

		// TODO COMMERCE-6339 ViewMiniCartItemWithDiscountLevels pending implementation
	}

	@description = "COMMERCE-6340. As a buyer, I want to be able to view subtotal and it's total price changed in the mini-cart summary when a discount with target 'Subtotal' is set"
	@ignore = "true"
	@priority = "3"
	test ViewMiniCartItemWithDiscountToSubtotal {
		property portal.acceptance = "false";

		// TODO COMMERCE-6340 ViewMiniCartItemWithDiscountToSubtotal pending implementation
	}

	@description = "COMMERCE-6341. As a buyer, I want to be able to view order discount and it's total price changed in the mini-cart summary when a discount with target 'Total' is set"
	@priority = "3"
	test ViewMiniCartItemWithDiscountToTotal {
		property portal.acceptance = "false";
		property test.name.skip.portal.instance = "CommerceMiniCart#ViewMiniCartItemWithDiscountToTotal";

		CommerceAccelerators.initializeNewSiteViaAccelerator(siteName = "Minium");

		CommerceNavigator.gotoPortlet(
			category = "Pricing",
			portlet = "Discounts");

		Click(locator1 = "Button#PLUS");

		CommerceEntry.addNewDiscountsEntry(
			channelsEligibility = "Minium Portal",
			discountAmount = "20",
			discountName = "Test Discount",
			discountTarget = "Total",
			discountType = "Percentage");

		Check.checkToggleSwitch(
			key_toggleSwitchLabel = "Active",
			locator1 = "ToggleSwitch#ANY_TOGGLE_SWITCH");

		ApplicationsMenu.gotoSite(site = "Minium");

		CommerceNavigator.gotoMiniumSidebarItem(menuItem = "Account Management");

		CommerceAcceleratorsInitializer.createNewAccountViaFront(
			accountName = "Commerce Account",
			adminEmailAddress = "test@liferay.com");

		CommerceNavigator.gotoMiniumSidebarItem(menuItem = "Catalog");

		CommerceAcceleratorsInitializer.changeProductsSorting(sortingType = "Name Ascending");

		FrontStore.addInitializerProductToCart(
			productName = "ABS Sensor",
			productQuantity = "1");

		CommerceNavigator.gotoMiniCart();

		AssertTextEquals(
			key_summaryTableItem = "Quantity",
			locator1 = "CommerceAccelerators#MINI_CART_SUMMARY_TABLE_ITEM",
			value1 = "1");

		AssertTextEquals(
			key_summaryTableItem = "Subtotal",
			locator1 = "CommerceAccelerators#MINI_CART_SUMMARY_TABLE_ITEM",
			value1 = "$ 50.00");

		AssertTextEquals(
			key_summaryTableItem = "Order Discount",
			locator1 = "CommerceAccelerators#MINI_CART_SUMMARY_TABLE_ITEM",
			value1 = "$ 10.00");

		AssertTextEquals(
			locator1 = "CommerceAccelerators#MINI_CART_SUMMARY_TABLE_TOTAL",
			value1 = "$ 40.00");
	}

	@description = "COMMERCE-6336. As a buyer, I want to see the barred list price and a sale price of an item in the mini-cart, if a promotion is set"
	@priority = "3"
	test ViewMiniCartItemWithPromotion {
		property portal.acceptance = "false";

		CommerceAccelerators.initializeNewSiteViaAccelerator(siteName = "Minium");

		Navigator.openWithAppendToBaseURL(urlAppend = "web/minium");

		CommerceNavigator.gotoMiniumSidebarItem(menuItem = "Account Management");

		CommerceAcceleratorsInitializer.createNewAccountViaFront(
			accountName = "Commerce Account",
			adminEmailAddress = "test@liferay.com");

		CommerceNavigator.gotoMiniumSidebarItem(menuItem = "Catalog");

		CommerceAcceleratorsInitializer.changeProductsSorting(sortingType = "Name Descending");

		FrontStore.addInitializerProductToCart(
			productName = "Premium Brake Fluid",
			productQuantity = "1");

		CommerceNavigator.gotoMiniCart();

		AssertTextEquals.assertPartialText(
			locator1 = "CommerceAccelerators#PRODUCT_DETAILS_LIST_PRICE_INACTIVE",
			value1 = "100.00");

		AssertTextEquals.assertPartialText(
			locator1 = "CommerceAccelerators#PRODUCT_DETAILS_LIST_PRICE_PROMO",
			value1 = "90.00");
	}

	@description = "COMMERCE-6342. As a buyer, I want to see the barred list price and the sale price on the mini-cart item and I want to be able to see tier price in the mini-cart summary"
	@ignore = "true"
	@priority = "3"
	test ViewMiniCartItemWithTierPrice {
		property portal.acceptance = "false";

		// TODO COMMERCE-6342 ViewMiniCartItemWithTierPrice pending implementation
	}

}